## 一、 问题引入

**旅行商问题 (Traveling Salesperson Problem, TSP)** 是数学建模和组合优化中的经典问题。

### 1.1 问题定义
一名推销员要从某城市出发，经过指定的若干个城市且**每个城市恰好访问一次**，最后回到**出发城市**。如何安排路线，使得**总行程最短**？

### 1.2 核心特点
*   **Hamilton 圈**：TSP 的本质是在图中寻找一个权重最小的哈密顿圈。
*   **计算复杂度**：随着城市数量 $n$ 的增加，可能的路径数量按 $(n-1)!$ 增长。这是一个典型的 **NP-hard** 问题，城市较多时无法通过穷举法解决。

---

## 二、 0-1 整数规划建模

为了精确描述 TSP，我们可以将其转化为整数规划问题。

### 2.1 决策变量
设 $x_{ij}$ 为决策变量：
$x_{ij}=\begin{cases}1, & \text{走城市 } i \text{ 到城市 } j \text{ 的路径} \\ 0, & \text{不走该路径}\end{cases}$

### 2.2 目标函数
最小化总距离：
$min\sum_{i \neq j}d_{ij}x_{ij}$
其中 $d_{ij}$ 是城市 $i$ 与城市 $j$ 之间的距离。

### 2.3 约束条件
1.  **出度约束**：从每个城市出发只有一条边。
    $\sum_{j=1}^{n}x_{ij}=1, i=1, 2, \dots, n$
2.  **入度约束**：到达每个城市只有一条边。
    $\sum_{i=1}^{n}x_{ij}=1, j=1, 2, \dots, n$
3.  **消除子圈约束 (Subtour Elimination)**：这是最关键也最复杂的约束。它保证所有选中的边必须构成一个连通的大圈，而不是几个独立的小圈。
    $\sum_{i,j \in s}x_{ij} \le |s|-1, 2 \le |s| \le n-1, s \subset \{1, 2, \dots, n\}$

---

## 三、 改良圈算法 (Heuristic Method)

由于整数规划在城市较多时计算极慢，实际常用**启发式算法**，如“改良圈算法”。

### 3.1 核心思想
先随机生成一个 Hamilton 圈，然后通过“局部交换边”的操作不断压缩路径长度，直到无法进一步改进。

### 3.2 算法逻辑：2-opt 交换
假设当前圈的顺序是 $\dots \to v_i \to v_{i+1} \to \dots \to v_j \to v_{j+1} \to \dots$
我们尝试去掉边 $(v_i, v_{i+1})$ 和 $(v_j, v_{j+1})$，改接边 $(v_i, v_j)$ 和 $(v_{i+1}, v_{j+1})$。

*   **判定条件**：如果 $w(v_i, v_j) + w(v_{i+1}, v_{j+1}) < w(v_i, v_{i+1}) + w(v_j, v_{j+1})$，则说明交换后路径更短。
*   **序列翻转**：交换后，原序列中从 $v_{i+1}$ 到 $v_j$ 的部分需要**整体反转**。

### 3.3 例子理解
**场景**：有 4 个点，当前路径 A-B-C-D-A。
1.  计算当前总长。
2.  尝试切断 A-B 和 C-D，尝试连接 A-C 和 B-D。
3.  新路径变为 A-C-B-D-A（注意中间 B、C 顺序反转了）。
4.  如果新长度 < 原长度，保留更改，继续寻找下一对可改进的边。

---

## 四、 辅助理解：简单示例

假设有四个城市：北京 ($v_1$)、上海 ($v_2$)、广州 ($v_4$)、曹县 ($v_3$)。
距离矩阵（对称）：

| | 北京($v_1$) | 上海($v_2$) | 曹县($v_3$) | 广州($v_4$) |
| :--- | :--- | :--- | :--- | :--- |
| **北京** | 0 | 56 | 21 | 35 |
| **上海** | 56 | 0 | 49 | 39 |
| **曹县** | 21 | 49 | 0 | 77 |
| **广州** | 35 | 39 | 77 | 0 |

### 4.1 方案对比
*   **随机路径 1**：$v_1 \to v_2 \to v_3 \to v_4 \to v_1$
    *   费用：$56(1-2) + 49(2-3) + 77(3-4) + 35(4-1) = 217$
*   **优化路径 2**：$v_1 \to v_3 \to v_2 \to v_4 \to v_1$
    *   费用：$21(1-3) + 49(3-2) + 39(2-4) + 35(4-1) = 144$

**结论**：通过简单的顺序调整（即改良圈的思想），路径长度从 217 缩减到了 144。

---

## 五、 MATLAB 实现说明

在数学建模中，求解 TSP 的 MATLAB 常用工具或函数：
*   **`ga` (遗传算法)**：非常适合处理这类组合优化问题。
*   **`linprog` / `intlinprog`**：用于求解小规模城市（如 $n < 20$）的精确整数规划。
*   **自定义函数**：手动编写改良圈算法。

> **注意**：在 `intlinprog` 中描述“消除子圈约束”需要使用动态添加约束的方法，否则约束数量会随城市数呈指数级爆炸。