## 一、 图的基本概念

### 1.1 定义与分类
*   **图的定义**：对于平面上的若干点，把这些点用曲线或直线连接起来，不考虑点的位置与连线的曲直长短，这样形成的结构即为**图**。
*   **数学表示**：$G=(V, E)$，其中 $V(vertex)$ 代表顶点的集合，$E(edge)$ 代表边的集合。
*   **分类**：
    *   **无向图**：边没有方向，类似于双向行驶的道路。
    *   **有向图**：边有特定的方向，类似于单行道，只能从起点向终点移动。

### 1.2 图的数据结构：邻接矩阵
在计算机或数学建模中，常用邻接矩阵来存储图的信息。对于一个有 $n$ 个节点的图，邻接矩阵是一个 $n \times n$ 的矩阵。

**例子**：假设有4个节点，1和2连通权重为5，1和3连通权重为10。

| 节点 | 1 | 2 | 3 | 4 |
| :--- | :--- | :--- | :--- | :--- |
| **1** | $0$ | $5$ | $10$ | $Inf$ |
| **2** | $5$ | $0$ | $Inf$ | $Inf$ |
| **3** | $10$ | $Inf$ | $0$ | $Inf$ |
| **4** | $Inf$ | $Inf$ | $Inf$ | $0$ |

*注：$Inf$ 表示两点之间没有直接路径，可以用正无穷去表示*

---

## 二、 最短路径问题的数学模型

最短路径问题旨在寻找图中两点之间权重（如距离、运费、时间）之和最小的路径。

### 2.1 整数规划表示
设决策变量为 $x_{ij}$，若弧 $v_iv_j$ 位于最短路上则 $x_{ij}=1$，否则 $x_{ij}=0$。
目标函数：$min \sum_{v_iv_j \in E} w_{ij}x_{ij}$
约束条件（流量平衡）：
$s.t. \sum_{j:v_iv_j \in E} x_{ij} - \sum_{j:v_jv_i \in E} x_{ji} = \begin{cases} 1, i=source \\ -1, i=terminal \\ 0, i \neq s,t \end{cases}$


用整数规划（Integer Programming, IP）来解决最短路径问题，核心思想是将图看作一个**“供需系统”**或**“流量系统”**。

我们可以把寻找最短路径想象成：**派一个人（一个单位的流量）从起点出发，必须经过一些中转站，最终到达终点。**

以下是这个逻辑的深度拆解：


#### 1. 核心逻辑：流量平衡 (Flow Balance)

这是最难理解的地方。想象你在城市交通网中：

*   **起点 (Source)**：产生了一个人，这个人必须走出去。
*   **中转站 (Intermediate Nodes)**：如果这个人进城了，他**必须**出城，不能消失，也不能留在城里。
*   **终点 (Sink)**：这个人进城后，任务完成，不再出来。

#### 数学表达：
设 $x_{ij}$ 是从节点 $i$ 到节点 $j$ 的这条路。如果走这条路，$x_{ij}=1$；不走则 $x_{ij}=0$。
对于图中每一个节点 $i$，我们要算：**出这个点的流量 - 进这个点的流量**。

$$ \sum_{j} x_{ij} - \sum_{j} x_{ji} $$

这个差值代表了这个节点的“净流量”，它有三种情况：

| 节点类型 | 净流量结果 | 逻辑解释 |
| :--- | :--- | :--- |
| **起点 ($i=1$)** | $1$ | 发出一个单位流量（路人甲出发了） |
| **终点 ($i=n$)** | $-1$ | 吸收一个单位流量（路人甲到达并停下） |
| **中转点 ($i \neq 1, n$)** | $0$ | 进多少出多少（路人甲只是路过，不在城里过夜） |

---

#### 2. 约束条件的例子

假设我们要从 **节点1** 去 **节点3**，中间经过 **节点2**。

**约束方程组：**
1.  **节点1（起点）：** $x_{12} + x_{13} = 1$ （从1出发，要么去2，要么直接去3）
2.  **节点2（中转）：** $x_{23} - x_{12} = 0$ （如果从1来了2，即 $x_{12}=1$，那么 $x_{23}$ 必须等于1才能平衡，也就是必须从2去3）
3.  **节点3（终点）：** $-x_{13} - x_{23} = -1$ （意味着 $x_{13}$ 和 $x_{23}$ 必有一个是1，即有人进来了）

**如果没有这些约束：**
模型可能会为了省钱（权重最小），哪条路都不选（全选0），因为不走任何路成本是0。但约束强制了流量必须从1流向3。

---

#### 3. 目标函数：最小化总成本

我们的目标是让经过的路径权重之和最小：
$$ min \sum_{i,j \in E} w_{ij} x_{ij} $$

*   如果 $x_{12}=1$，则加上 $w_{12}$ 的权重。
*   如果 $x_{12}=0$，则这部分的成本是 $0$。


### 2.2蒙特卡洛暴力枚举（实际应用不会用）

---

## 三、 迪杰斯特拉（Dijkstra）算法

### 3.1 算法原理
Dijkstra 算法采用**贪心策略**。它维护一个从源点到各节点的当前最短距离，每次从未访问的节点中选择距离最小的一个，并以此节点为跳板更新其邻居节点的距离。

### 3.2 算法核心数组
*   **visited**：记录节点是否已固定最短路径（0为未访问，1为已访问）。
*   **distance**：记录源点到该节点的最短距离（初始为 $Inf$，源点为0）。
*   **pre**：记录该节点在最短路径上的前驱节点，用于回溯路径。

![[Screenshot 2026-01-26 at 19.05.33.png]]
### Dijkstra 算法的标准“三步走”循环：

**第一步（选点）：**  
在所有**还没进入 visited** 的节点中，找一个 **distance 最小** 的节点。

- 逻辑： 既然它是离起点最近的“未访客”，那根据贪心策略，从起点到它的最短路径已经确定了，不可能有更短的绕路方案。
    

**第二步（纳入）：**  
把这个节点纳入 **visited**（标记为 1）。它现在成了我们的“基地”或“跳板”。

**第三步（更新/松弛）：**  
从这个“跳板”出发，看它**直接相连**的邻居们（通常只看还没进 visited 的邻居）：

1. 计算：起点到跳板的距离 + 跳板到邻居的边权 = **新路径长度**。
    
2. 比较：如果 新路径长度 < 表格里原本的 distance：
    
    - **修改**：把表格里的 distance 更新为这个更小的值。
        
    - **记路**：把 pre（前驱）改为这个“跳板”，记住是从哪儿绕过来的。
        

---
### 3.4 局限性
**Dijkstra算法不能解决含有负权重的图**。
由于其贪心特性，一旦某个节点被标记为 `visited`，其距离将不再更新。但在负权图中，后续可能会出现更小的路径导致逻辑失效。

---

## 四、 负权值问题的解决方案

当图中存在负权重边时，需要使用其他算法：

| 算法名称                | 核心思想               | 特点                     |
| :------------------ | :----------------- | :--------------------- |
| **Bellman-Ford 算法** | 对所有边进行 $n-1$ 次松弛操作 | 复杂度较高，但能处理负权边并检测负权环    |
| **Floyd 算法**        | 动态规划，尝试引入中间节点进行跳转  | 求出图中任意两点之间的最短路径（多源最短路） |

---

## 五、 MATLAB 实现

MATLAB 提供了内置函数 `shortestpath` 方便求解。

### 5.1 函数原型
`[P, d] = shortestpath(G, start, end, ['method', algorithm])`

### 5.2 参数说明
| 参数/返回值          | 说明                            |
| :-------------- | :---------------------------- |
| **G**           | 图对象（由 `graph` 或 `digraph` 创建） |
| **start / end** | 起点和终点的索引或名称                   |
| **P**           | 最短路径经过的节点序列                   |
| **d**           | 最短距离数值                        |
| **'auto'**      | 默认值，根据图的特征自动选择算法              |
| **'positive'**  | 强制使用 Dijkstra 算法（要求权重非负）      |
| **'mixed'**     | 使用 Bellman-Ford 算法（允许负权重）     |

---

## 六、 数学建模综合案例：钢管订购计划

### 6.1 问题核心
在2000年全国大学生数学建模竞赛B题中，需要从多个钢管厂订购钢管并运输到铺设线路。（神题巨难）

### 6.2 解题思路
1.  **权值转换**：图中的原始信息是物理里程。但由于铁路和公路的运费计算方式不同（铁路通常是分段计价，公路是单价计价），不能直接用物理距离作为权重。
2.  **构建运费矩阵**：
    *   利用 Dijkstra 或 Floyd 算法分别计算各厂到各节点的“最小铁路运费”和“最小公路运费”。
    *   取两者中的较小值作为最终的边权重 $c_{ij}$。
3.  **建立数学规划模型**：
    *   **目标函数**：总费用 = 订购费 + 运输费。
    *   **约束条件**：各厂产能上限、各段线路需求量、流量平衡等。

### 6.3 关键结论
在处理复杂运输问题时，**“图论最短路”往往只是预处理步骤**，其目的是为了获得节点间的最小代价矩阵，后续通常需要配合**线性规划或整数规划**来求解全局最优解。