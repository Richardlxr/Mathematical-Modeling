## 一、 问题引入

**最小费用最大流问题（Minimum Cost Maximum Flow Problem）**是网络流问题的进阶版。在上一讲中，我们只关心如何让流量最大；但在实际应用中，经过每一条弧通常都需要支付一定的“代价”（如运费、体力消耗、时间成本）。

**核心目标：在保证网络流量达到**最大**的前提下，寻找一种路径分配方案，使得总的**费用支出最小。


---

## 二、 基本概念与数学模型

### 2.1 定义
*   **可行流 $x_{ij}$：** 弧 $(v_i, v_j)$ 上的实际流量。
*   **单位费用 $w_{ij}$：** 弧 $(v_i, v_j)$ 上通过一个单位流量所需支付的费用。
*   **总费用：** $Z = \sum_{(v_i, v_j) \in A} w_{ij} \cdot x_{ij}$

### 2.2 逻辑推导
1.  **如果只派 1 个人：** 这就是一个简单的**最短路径问题**，权值为单位费用 $w_{ij}$。可以使用 Dijkstra 算法求解。
2.  **如果要派尽量多的人：** 我们需要不断寻找从起点到终点的“最省钱增广链”。

---

## 三、 求解方法：连续最短路算法

求解最小费用最大流的基本思想是：**在残余网络中，不断寻找关于“单位费用”的最短路径进行增广。**

### 3.1 核心算法步骤表

| 步骤      | 动作   | 详细说明                                       |
| :------ | :--- | :----------------------------------------- |
| **第一步** | 初始化  | 从零流开始，构建初始网络。                              |
| **第二步** | 找最短路 | 以**单位费用 $w_{ij}$** 为权值，寻找从发点到收点的最短路径 $P$。  |
| **第三步** | 找增广量 | 在路径 $P$ 上，寻找所有弧中**剩余容量最小**的值 $\Delta$。     |
| **第四步** | 更新流量 | 路径 $P$ 上所有前向弧流量 $+ \Delta$；总流量增加 $\Delta$。 |
| **第五步** | 更新网络 | 增加反向弧。**关键：** 反向弧的单位费用设为 $-w_{ij}$（表示退款）。  |
| **第六步** | 循环   | 重复上述步骤，直到找不到从发点到收点的路径。                     |

---

### 3.2 例子辅助理解：反向弧的妙用
假设有一条路 $A \to B$，容量为 10，单价为 5 元。
1.  我们送了 6 单位流量过去，花费 $6 \times 5 = 30$ 元。
2.  此时网络中会产生一条 $B \to A$ 的反向弧，容量为 6，**单价为 -5 元**。
3.  **逻辑解释：** 如果后续路径发现从别的路走更便宜，需要“退回”这 6 个流量，那么每退回 1 单位，就能省下（即赚回）5 元。这就是负权值的意义。

*注：由于计算过程中会出现负权值弧，最短路算法建议使用 **Bellman-Ford** 或 **SPFA**，而非标准的 Dijkstra。*

---

## 四、 求解方法总结

### 4.1 思想原理
通过弧的体力消耗（费用）作为标准求解最短路径，可以保证当前的增广路径一定是当前最省钱的。由于是从零流开始构建，每一步都选最便宜的，最终当流量无法再增加时，得到的就是最小费用下的最大流。

### 4.2 弧的状态变化规则
*   **若 $0 < x_{ij} < c_{ij}$：** 流量可增可减。保留原弧（权值 $w_{ij}$），添加反向弧（权值 $-w_{ij}$）。
*   **若 $x_{ij} = c_{ij}$：** 流量已满。删除原弧（无法再增），添加反向弧（权值 $-w_{ij}$）。
*   **若 $x_{ij} = 0$：** 流量为空。保留原弧（权值 $w_{ij}$），无反向弧。

---

## 五、 MATLAB 实现与应用

在数学建模中，最小费用最大流通常需要结合 `Optimization Toolbox` 或自定义函数。

### 5.1 常用逻辑框架
```matlab
% 伪代码逻辑
while 存在增广路
    [dist, path] = shortestpath_algorithm(ResidualGraph); % 寻找费用最短路
    delta = min_capacity(path); % 找路径上的最小残余容量
    TotalFlow = TotalFlow + delta;
    TotalCost = TotalCost + delta * dist;
    update_residual_graph(); % 更新流量及反向弧权重
end
```

